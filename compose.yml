services:
  # 1. THE GATEKEEPER
  gatekeeper:
    image: nginx:alpine
    container_name: ng-gatekeeper
    restart: always
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./nginx/login.html:/usr/share/nginx/html/login.html:ro
    environment:
      - VIRTUAL_HOST=docs2.nourgaser.com
      - LETSENCRYPT_HOST=docs2.nourgaser.com
      - PORT=80
    expose:
      - "80"

  # 2. THE WRITER (Admin Mode)
  sb-writer:
    image: ghcr.io/silverbulletmd/silverbullet
    container_name: ng-writer
    restart: always
    volumes:
      # Mount the Writer Space (Has all symlinks)
      - ./spaces/writer:/space
    # No Auth here because Nginx protects it. 
    # But for extra security in production, we'd add Basic Auth between Nginx->SB.

  # 3. THE READER (Guest Mode)
  sb-reader:
    image: ghcr.io/silverbulletmd/silverbullet
    container_name: ng-reader
    restart: always
    # Force Read-Only Mode at the App level
    environment:
      - SB_READ_ONLY=true
    volumes:
      # Mount the Public Space (Has only public symlinks)
      - ./spaces/public:/space:ro

networks:
  default:
    external: true
    name: nginx-proxy